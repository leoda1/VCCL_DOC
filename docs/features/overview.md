# 核心功能概述

VCCL (Virtualized Collective Communication Library) 提供了一系列先进的通信优化功能，专为现代 AI 训练集群设计。本页面概述了 VCCL 的所有核心特性。

## 功能总览

| 功能 | 状态 | 默认启用 | 主要优势 |
|------|------|----------|----------|
| [拓扑感知负载均衡](topology-aware.md) | ✅ 可用 | 是 | 智能路由，减少网络拥塞 |
| [PCIe异构与SRS](pcie-heterogeneity.md) | ✅ 可用 | 是 | 自适应硬件选择 |
| [流可视化遥测](flow-telemetry.md) | ✅ 可用 | 否 | 实时监控与诊断 |
| [容错机制](fault-tolerance.md) | ✅ 可用 | 是 | 高可用性保障 |
| [SM Free & Overlap](sm-free-overlap.md) | ✅ 可用 | 否 | 通信计算真正重叠 |

## 核心特性详解

### 1. 拓扑感知流量负载均衡
**目标**: 优化网络流量分布，提高整体通信效率

- **支持策略**: RING、ECMP、PXN
- **自动发现**: 网络拓扑自动感知
- **动态调整**: 根据负载情况实时调整路由

### 2. PCIe 异构与智能 RNIC 选择 (SRS)
**目标**: 在异构硬件环境中选择最优的网络接口

- **异构支持**: 不同PCIe代数和带宽的混合环境
- **智能选择**: 基于实时性能指标选择最优RNIC
- **自适应**: 运行时动态调整选择策略

### 3. 流可视化遥测
**目标**: 提供深度的通信流洞察和诊断能力

- **实时监控**: 通信流量、延迟、带宽利用率
- **历史数据**: 可配置的数据窗口大小
- **诊断辅助**: 性能瓶颈识别和故障定位

### 4. 容错机制
**目标**: 在硬件故障或网络异常时保持通信可靠性

- **故障检测**: 自动检测节点和链路故障
- **自动恢复**: 透明的故障恢复机制
- **零停机**: 最小化训练中断时间

### 5. SM Free & Overlap
**目标**: 实现通信与计算的真正并行，最大化GPU利用率

- **SM隔离**: 通信操作不占用GPU SM资源
- **真正重叠**: 通信与计算完全并行执行
- **性能提升**: 显著提高整体训练效率

## 配置策略

### 默认配置
VCCL 采用"开箱即用"的设计理念，大部分功能默认启用：

```bash
# 默认启用的功能
NCCL_ENABLE_FAULT_TOLERANCE=1    # 容错机制
# 拓扑感知负载均衡 - 默认启用
# PCIe异构与SRS - 默认启用
```

### 按需启用
某些高级功能需要根据具体需求启用：

```bash
# 流可视化遥测
NCCL_TELEMETRY_ENABLE=1
TELEMETRY_WINDOWSIZE=50
NCCL_TELEMETRY_LOG_PATH=/path/to/logs

# SM Free模式
NCCL_PASS_SM=1
```

## 性能影响

### 性能提升
| 场景 | 性能提升 | 主要贡献功能 |
|------|----------|--------------|
| 大规模AllReduce | 15-30% | 拓扑感知负载均衡 |
| 异构集群训练 | 10-25% | 智能RNIC选择 |
| 长时间训练 | 5-15% | 容错机制减少重启 |
| 计算密集型模型 | 20-40% | SM Free & Overlap |

### 资源开销
| 功能 | 内存开销 | CPU开销 | 网络开销 |
|------|----------|---------|----------|
| 拓扑感知 | < 1MB | < 1% | 忽略不计 |
| 流遥测 | 2-10MB | 1-3% | < 1% |
| 容错机制 | < 5MB | < 2% | < 2% |
| SM Free | 忽略不计 | 忽略不计 | 忽略不计 |

## 最佳实践

### 1. 功能组合建议
```bash
# 生产环境推荐配置
export NCCL_ENABLE_FAULT_TOLERANCE=1
export NCCL_TELEMETRY_ENABLE=1
export NCCL_PASS_SM=1
export NCCL_IB_HCA=mlx5_0:1,mlx5_1:1,mlx5_2:1,mlx5_3:1
```

### 2. 调优策略
- **网络密集型**: 重点调优拓扑感知和负载均衡
- **计算密集型**: 重点启用SM Free模式
- **大规模集群**: 启用完整的容错和遥测功能

### 3. 故障排查
- 使用流遥测功能识别性能瓶颈
- 通过容错日志分析网络稳定性
- 利用拓扑信息优化节点分配

## 下一步

- 📖 阅读各个功能的详细文档
- 🚀 查看 [使用指南](../usage/installation.md) 开始部署
- ⚙️ 参考 [环境变量](../environment-variables.md) 进行详细配置

---

!!! tip "功能选择建议"
    新用户建议从默认配置开始，然后根据具体需求逐步启用高级功能。

!!! warning "配置注意事项"
    某些功能组合可能需要额外的硬件要求或网络配置，请参考各功能的详细文档。
